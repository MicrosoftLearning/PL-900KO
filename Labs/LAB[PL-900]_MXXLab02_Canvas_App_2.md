---
lab:
    title: '랩 02: 캔버스 앱, 파트 2'
    module: '모듈 XX: Power Apps 빌드'
---

# PL-900: Microsoft Power Platform 기본 사항
## 모듈 X, 랩 2 – 캔버스 앱 - 파트 2

시나리오
========

Bellows College는 캠퍼스 내에 여러 건물이 있는 교육 기관입니다. 캠퍼스 방문은 현재 종이에 기록되어 있습니다. 이 정보는 일관되게 캡처되지 않으며, 전체 캠퍼스 방문 데이터를 수집하고 분석할 방법이 없습니다. 

캠퍼스 관리부는 건물 액세스가 보안 요원에 의해 제어되고, 모든 방문이 반드시 호스트에 의해 사전 등록 및 기록되는 현대화된 방문자 등록 시스템을 원합니다.

이 과정 전반에 걸쳐 Bellows College 관리 및 보안 담당자가 캠퍼스 내 건물의 액세스를 관리하고 제어할 수 있도록 애플리케이션을 구축하고 자동화를 수행합니다. 

이 랩의 파트 2에서는 보안 담당자가 건물 입구에서 방문자를 신속하게 확인하고 등록하는 데 사용할 Power Apps 캔버스 앱의 디자인을 만들고 빌드합니다.

고급 랩 단계
======================

캔버스 앱을 디자인하려면 아래 개요를 따릅니다.

-   휴대폰 폼 팩터를 사용하여 앱 만들기
-   데이터 원본으로 Common Data Service에 연결
-   입력(방문자 코드) 내용을 확보하고 방문자 레코드를 찾습니다.
-   방문자 정보를 표시하도록 폼 뷰어 컨트롤을 구성합니다.
-   CDS 뷰를 사용하여 갤러리를 채웁니다.
-   방문자의 체크 인 및 체크 아웃 프로세스를 처리합니다.


## 사전 요구 사항

* 랩 1 완료 - 데이터 모델링

시작하기 전에 고려해야 할 사항
-----------------------------------

-   보안 담당자가 빠르게 액세스하기 위해 필요한 정보는 무엇입니까?
-   방문자 코드가 유효하지 않은 경우 어떻게 해야 합니까?
-   방문자가 예약된 시간 이외에 도착하면 어떻게 해야 합니까? 

연습 \#1: 보안 캔버스 앱 만들기
===============================

**목표:** 이 연습에서는 캔버스 앱을 만듭니다.

태스크 \#1: 캔버스 앱 만들기
---------------------------

1.  캠퍼스 관리 솔루션을 엽니다.

    -   <https://make.powerapps.com>에 로그인합니다

    -    **환경**을 선택합니다.

    -   **솔루션**을 선택합니다.

    -   클릭하여 **캠퍼스 관리** 솔루션을 엽니다.
2.  새 캔버스 애플리케이션 만들기

    -   **새로 만들기**를 클릭하고 **앱 \| 캔버스 앱 \| 휴대폰 폼 팩터**를 선택합니다.
        그러면 새 창에서 앱 편집기가 열립니다.
-   첫 번째 앱을 만드는 경우 이 앱을 설정하라는 요청이 표시됩니다.
        앱의 국가/지역입니다. **시작하기**를 클릭합니다.
    -   파일을 클릭하고 다른 이름으로 저장을 선택합니다.
-   **클라우드**가 선택되어 있는지 확인합니다. 이름에 대한 **캠퍼스 보안**을 입력하고
        **저장**을 클릭합니다. 이렇게 하면 앱이 예기치 않게 닫혔을 경우에
    변경 사항이 삭제되지 않습니다.
3.  데이터 원본에 연결(방문)
    1.  **보기 | 데이터 원본**을 클릭합니다.
    2.  **모든 엔터티 보기**를 클릭합니다.
    3.  **방문**을 선택합니다.
4.  진행 중인 작업을 유지하려면 **파일 | 저장**을 클릭한 후 **저장**을 누릅니다.

작업 \#2: 방문자 정보 표시
--------------------------------

1.  검색 상자 추가

    -   **트리 뷰** 탭을 선택합니다.
    -   **Screen1**을 선택합니다.
    -   **삽입** 탭으로 이동합니다.
    -   **텍스트**를 클릭하고 **텍스트 입력**을 선택합니다.
    -   **기본값** 속성을 선택하고 값 선택을 취소합니다.
    -   **HintText** 속성을 선택하고 값으로 **"방문자 코드 입력"**을 입력합니다(큰따옴표 포함).
    -   트리 뷰에서 이름을 제어하려면 옆에 있는 ... 기호를 클릭하고 **이름 바꾸기**를 선택하여 이름을 **textCode**로 변경합니다.
2. 양식 보기 추가

   -   **삽입** 탭에서 **양식**을 클릭한 다음 **표시**를 선택합니다.
   -   크기 핸들을 사용하여 검색 텍스트 상자 아래에 양식 위치를 지정합니다.
   -   **DataSource** 속성을 선택하고 **방문**을 입력합니다.
   -   속성 창에서 **수평**을 **레이아웃**으로 선택합니다.
   -   **필드 편집**을 클릭합니다.
   -   **필드 추가**를 클릭하고 다음 필드를 선택합니다. 실제 종료, 실제 시작, 건물, 예약된 종료, 예약된 시작, 방문자
   -   **추가**를 누릅니다.
   -   목록에서 필드 카드를 드래그하여 선택한 필드의 순서를 변경합니다. 권장 순서는 방문자, 건물, 예약된 시작, 예약된 종료, 실제 시작, 실제 종료입니다.
   -   **항목** 속성을 선택하고 `LookUp(Visits, Code = textCode.Text)`를 입력합니다. 

3.  진행 중인 작업을 유지하려면 **파일 | 저장**을 클릭한 후 **저장**을 누릅니다.

4. 앱 테스트

   -   솔루션이 포함된 브라우저 탭으로 전환합니다.
   -   **방문** 엔터티를 선택합니다.
   -   **데이터** 탭을 선택합니다.
   -   **보기 선택**을 클릭한 다음 **모든 필드**를 선택합니다.
   -   **코드** 열에 표시된 값을 선택하고 복사합니다.
   -   브라우저 탭을 앱으로 전환하고 F5 키를 눌러 앱을 실행합니다.
   -   복사된 값을 검색 텍스트 상자에 붙여 넣고 레코드가 양식에 표시되는지 확인합니다.
5.  **ESC** 키를 눌러 실행 중인 앱을 종료합니다.


작업 \#3: 체크 인 및 체크 아웃 단추를 추가합니다.
---------------------------------------

1. 변수에 검색 결과를 저장하여 컨트롤 전체에서 재사용합니다.

   * **textCode** 컨트롤을 선택합니다.
   * **OnChange** 속성을 선택합니다.
   * 다음 `Set(Visit, LookUp(Visits, Code = textCode.Text))` 식을 입력합니다.
     전역 변수에 결과를 저장하는 경우를 제외하고는 위와 동일한 식입니다. 이를 통해 전체 조회 식을 다시 입력할 필요 없이 앱 전체에서 *방문* 변수를 사용할 수 있습니다.

2. 체크인 및 체크아웃 용 버튼을 추가힙니다.
   
1. **삽입** 탭을 선택합니다.
   2. **단추**를 클릭합니다.
   3. 단추 **Text** 속성을 **"체크 인"**으로 변경합니다.
   4. 단추의 이름을 **CheckInButton**으로 바꿉니다.
   5. **단추**를 클릭하여 다른 단추를 삽입합니다.
   6. 단추 **Text** 속성을 **"체크 아웃"**으로 변경합니다.
   7. 단추의 이름을 **CheckOutButton**으로 변경합니다.
   8. 단추를 레코드 양식 뷰 아래에 나란히 배치합니다. 
   
3. 방문 데이터에 따라 단추를 활성화 및 비활성화합니다. 
   방문 레코드가 있고(비어 있지 않음), 레코드 상태가 활성화되어 있으며 방문이 아직 시작되지 않은 경우(즉, 실제 시작 값이 비어 있음) **체크 인** 단추를 사용하도록 설정합니다.

   * 단추의 **DisplayMode** 속성을 선택합니다.

   * 아래에 식을 입력합니다.

      ```
      If(!IsBlank(Visit) 
      && Visit.Status = 'Status (Visits)'.Active
      && IsBlank(Visit.'Actual Start'),
          DisplayMode.Edit,
          DisplayMode.Disabled
      )
      ```

   식은 다음과 같이 세분화할 수 있습니다.

   * `!IsBlank(Visit)` - 방문 레코드가 발견됨
   * `&&` - 논리 AND 연산자
   * 레코드의 `Visit.Status = 'Status (Visits)'.Active` 상태가 *활성*임
   * `IsBlank(Visit.'Actual Start')` - 활성 시작 필드에 데이터가 없음

4. 방문 레코드가 있고(비어 있지 않음) 레코드 상태가 활성화되어 있으며 방문이 이미 시작된 경우(즉, 실제 시작 값이 비어 있지 않음) **체크 아웃** 단추를 사용하도록 설정합니다.

   * **체크 아웃** 단추의 **DisplayMode** 속성을 선택합니다.

   * 아래에 식을 입력합니다.

     ```
     If(!IsBlank(Visit) 
     && Visit.Status = 'Status (Visits)'.Active
     && !IsBlank(Visit.'Actual Start'),
         DisplayMode.Edit,
         DisplayMode.Disabled
     )
     ```

5. 진행 중인 작업을 유지하려면 **파일 | 저장**을 클릭한 후 **저장**을 누릅니다.

6. **F5** 키를 눌러 앱을 실행합니다. 두 단추를 모두 사용하지 않도록 설정해야 합니다. 이전에 복사한 코드 값을 입력하고 **탭** 키를 눌러 텍스트 상자에서 포커스를 이동합니다. **체크 인** 단추를 사용하도록 설정해야 합니다.

7. **ESC** 키를 눌러 실행 중인 앱을 종료합니다.

## 작업 #4: 전체 체크 인 및 체크 아웃 프로세스

체크 인 및 체크 아웃 프로세스를 수행하려면 다음과 같이 CDS 방문 데이터를 업데이트해야 합니다.

* 방문자가 체크인 할 때 *실제 시작* 필드를 현재 날짜 및 시간으로 설정합니다.
* 방문자가 체크 아웃할 때 *실제 종료* 필드를 현재 날짜 및 시간으로 설정합니다. 
* 체크 아웃 후 레코드 상태를 방문이 완료되었음을 나타내는 비활성 상태로 설정합니다.

1. **체크 인** 단추를 선택합니다.

2. **OnSelect** 속성을 다음 식으로 설정합니다.

   ```
   Patch(
       Visits,
       Visit,
       {'Actual Start': Now()}
   );
   Refresh([@Visits]);
   Set(Visit, LookUp(Visits, Code = textCode.Text));
   ```

   이 식에는 다음 부분이 포함되어 있습니다.

   * `Patch(Visits, Visit, {'Actual Start': Now()});`. *패치* 메서드는 **방문** 변수로 식별된 레코드(현재 방문)인 **방문** 엔터티를 업데이트합니다. 식은 *실제 시작* 필드의 값을 현재 날짜 및 시간(*Now()* method)으로 설정합니다.
   * `Refresh([@Visits]);`. 이 식은 기본 값이 변경됨에 따라 방문 레코드를 새로 고칩니다.
   * `Set(Visit, LookUp(Visits, Code = textCode.Text));` - 이 식은 CDS의 새 데이터로 *방문* 변수를 업데이트합니다.

3. **체크 아웃** 단추를 선택합니다.

4. **OnSelect** 속성을 다음 식으로 설정합니다.

   ```
   Patch(
       [@Visits],
       Visit,
       {
           'Actual End': Now(),
           Status: 'Status (Visits)'.Inactive
       }
   );
   Refresh([@Visits]);
   Set(Visit, LookUp(Visits, Code = textCode.Text));
   ```

   표현식의 확인에서 유일한 차이점은 *상태* 필드를 *비활성* 값으로 설정하는 것입니다.

5. 진행 중인 작업을 유지하려면 **파일 | 저장**을 클릭한 후 **저장**을 누릅니다.

6. **F5** 키를 눌러 앱을 실행합니다. 이전에 복사한 코드 값을 입력하고 **탭** 키를 눌러 텍스트 상자에서 포커스를 이동합니다. **체크 인** 단추를 사용하도록 설정해야 합니다.

7. **체크 인** 단추를 누릅니다. 다음과 같은 일이 발생합니다.

   1. *실제 시작*에는 현재 날짜 및 시간이 포함됩니다.
   2. **체크 인** 단추를 사용할 수 없습니다.
   3. **체크 아웃** 단추가 활성화되어 있습니다.

8. **체크 아웃** 단추를 누릅니다.

   1. *실제 종료*에는 현재 날짜와 시간이 포함됩니다.
   2. 두 단추 모두 사용할 수 없습니다.

9. **ESC** 키를 눌러 실행 중인 앱을 종료합니다.

작업 \#5: 시각적 표시기 추가
--------------------------------------

모바일 앱의 유용성은 텍스트 정보 외에도 시각적 표시기가 제공될 때 크게 향상됩니다. 이 작업에서는 방문자를 체크 인하거나 체크 아웃할 수 있는지 여부를 나타내는 아이콘을 추가합니다.

1. **축소** 탭 선택

2. **아이콘 | 추가**를 선택합니다. 이 시점에서는 값이 동적이기를 원하기 때문에 어떤 아이콘을 선택하는지는 중요하지 않습니다.

3. 단추 아래의 화면 중앙에 있는 아이콘 크기 다시 조정 및 배치

4. **아이콘** 속성을 선택하고 다음 식을 입력합니다.

   ```
   If(
      CheckInButton.DisplayMode = DisplayMode.Disabled 
   && CheckOutButton.DisplayMode = DisplayMode.Disabled,
       Icon.EmojiFrown,
       Icon.EmojiSmile
   )
   ```

5. 진행 중인 작업을 유지하려면 **파일 | 저장**을 클릭한 후 **저장**을 누릅니다.
6. **F5** 키를 눌러 앱을 실행합니다. 이전에 복사한 코드 값을 입력하고 **탭** 키를 눌러 텍스트 상자에서 포커스를 이동합니다. 아이콘이 찡그린 이모지를 표시하는지 확인합니다.
7. 이전에 사용되지 않은 다른 코드 값을 찾습니다. 이전에 만든 **Campus Staff** 앱을 실행하여 새 방문 레코드를 만들 수 있습니다. 아이콘이 미소 이모지를 표시했는지 확인합니다.
8. **ESC** 키를 눌러 실행 중인 앱을 종료합니다.

## 작업 #6: 앱을 게시합니다.

1. **Campus Security** 앱을 선택하고 **편집**을 클릭합니다.
2. **파일 | 게시**를 선택합니다. 

# 과제

* 방문 코드의 수동 입력을 피하는 방법은 무엇입니까?
* 방문에 대한 건물 유효성 검사 추가
* 방문 실제 시간 대 방문 예약 시간(너무 일찍, 너무 늦게 등)의 유효성 검사를 추가합니다.
* 방문의 자세한 상태(예: 방문자에 대한 이메일 표시 및 유효성 검사, 건물 출입 거부 이유 등)를 추가합니다.
* 단일 캠퍼스 방문 중에 여러 건물/회의/검사의 요구 사항을 어떻게 처리합니까? 예를 들어, 누군가가 하루 동안 캠퍼스를 방문할 수 있으며, 그 하루 동안 다른 시간에 여러 건물에서 직원들을 만날 수 있습니다. *약속* 엔티티를 솔루션으로 가져오는 것을 고려하겠습니까?