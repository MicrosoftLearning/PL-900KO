---
lab:
    title: '랩: Power Automate'
    module: '모듈 4: Power Automate 시작하기'
---

# 모듈 4: Power Automate 시작하기
## 랩: Power Automate

시나리오
========

Bellows College는 캠퍼스 내에 여러 건물이 있는 교육 기관입니다. 캠퍼스 방문자는 현재 종이 저널에 기록되어 있습니다. 정보가 일관되게 수집되지 않아 전체 캠퍼스 방문 데이터를 수집하고 분석할 방법이 없습니다. 

캠퍼스 관리부는 건물 액세스가 보안 요원에 의해 제어되고, 모든 방문이 반드시 호스트에 의해 사전 등록 및 기록되는 현대화된 방문자 등록 시스템을 원합니다.

이 과정 전반에 걸쳐 벨로즈 칼리지 관리 및 보안 담당자가 캠퍼스 내 건물에 대한 액세스를 관리하고 제어할 수 있도록 애플리케이션을 빌드하고 자동화를 수행합니다. 

이 랩에서는 캠퍼스 관리의 다양한 부분을 자동화하는 Power Automate 흐름을 만듭니다. 

고급 랩 단계
======================

프로젝트 완료를 위해 구현해야 하는 요구 사항은 다음과 같습니다.

* 각 방문자에게 할당된 고유 코드는 방문 전에 사용할 수 있어야 합니다.
* 보안 담당자는 예정된 시간대를 초과하여 머무는 방문자에 대한 알림을 받아야 합니다.

## 사전 요구 사항

* 랩 1 완료 - 데이터 모델링
* 캠퍼스 직원 앱은 랩 2의 파트 1 – 캔버스 앱(테스트용)에서 만들었습니다

시작하기 전에 고려해야 할 사항
-----------------------------------

-   방문자 코드에 가장 적합한 배포 메커니즘은 무엇인가요?
-   오버스테이를 측정하고 엄격한 정책을 시행하는 방법.

연습 \#1: 방문 알림 흐름 만들기
===============================

**목표:** 이 연습에서는 요구 사항을 구현하는 Power Automate 흐름을 만듭니다. 방문자 알림은 이메일을 사용하여 실시됩니다. 알림에는 방문에 할당된 고유 코드가 포함됩니다.

작업 \#1: 흐름 만들기
---------------------------

1.  캠퍼스 관리 솔루션을 엽니다.

    -   <https://make.powerapps.com>에 로그인합니다

    -   **환경**을 선택합니다.

    -   **솔루션**을 선택합니다.

    -   클릭하여 **캠퍼스 관리** 솔루션을 엽니다.

2.  **새로 만들기**를 클릭하고 **흐름**을 선택합니다. 그러면 새 창에서 흐름 편집기가 열립니다.

3. **현재**를 검색하고 **Common Data Service(현재 환경)** 커넥터를 선택합니다.

4. **레코드가 만들어질 때**, **업데이트될 때** 또는 **삭제될 때** 트리거를 선택합니다.

   * **트리거 조건**에 대한 **만들기** 선택
   * **엔터티 이름**에 대한 **방문** 선택
   * **범위**에 대한 **조직** 선택

5.  **새 단계**를 클릭합니다. 이 단계는 전자 메일을 포함하여 방문자 정보를 검색하는 데 필요합니다.

6. **현재**를 검색하고 **Common Data Service(현재 환경)** 커넥터를 선택합니다.

7. **레코드 가져오기** 작업을 선택합니다. 

   * **연락처**를 **엔터티 이름**으로 선택합니다.
   * **항목 ID** 필드에서 동적 콘텐츠 목록의 **방문자(값)**를 선택합니다.

8. **새 단계**를 클릭합니다. 이 단계는 방문자에게 전자 메일을 만들고 보내는 단계입니다.

9. *메일*을 검색하고 **메일** 커넥터를 선택해서 **전자 메일 알림 보내기** 작업을 찾습니다. 
   * 이 작업을 사용하기 위한 이용 약관을 수락하라는 메시지가 표시되면 **수락**을 클릭합니다.
   
   * **받는 사람** 필드를 선택하고 동적 콘텐츠 목록에서 **전자 메일**을 선택합니다.

   * **Bellows College 예약 방문**을 **제목** 필드에 입력합니다.

   * **전자 메일 본문**에 다음 텍스트를 입력합니다.  
        *참고: 필드가 괄호 안에 명명된 곳에 동적 콘텐츠를 배치해야 합니다. 먼저 모든 텍스트를 입력한 다음, 올바른 위치에 동적 콘텐츠를 추가하는 것이 좋습니다.*

   ```
    {이름}에게,

    현재 {예약된 시작}에서 {예약된 종료}까지 Bellows 캠퍼스를 방문할 예정입니다.

    보안 코드는 {코드}이며 공유하지 마세요. 방문하는 동안 이 코드를 생성해야 합니다.


    안녕히 계세요.

    캠퍼스 관리
    Bellows College
   ```
   
10.  상단에서 **제목 없음** 흐름 이름을 선택하고 **방문 알림**으로 이름을 바꿉니다.

11.  **저장**을 누릅니다

작업 \#2: 흐름의 유효성 검사 및 테스트
--------------------------------

1.  만든 **캠퍼스 직원**앱 열기 
2.  +를 눌러 새 방문 레코드를 추가합니다.
3.  필요한 정보를 입력하고 **저장**을 누릅니다.
4.  흐름을 열고 가장 최근 **실행**을 찾아서 엽니다.
5.  **메일** 단계를 열고 이메일 콘텐츠가 올바르게 생성되었는지 확인합니다.

# 연습 #2: 보안 스윕 흐름 만들기

**목표:** 이 연습에서는 요구 사항을 구현하는 Power Automate 흐름을 만듭니다. 보안 스윕은 15분마다 실시되며 방문자가 예정된 시간을 초과하여 머물면 보안 알림이 전송됩니다.

## 작업 #1: 레코드를 검색하는 흐름을 만듭니다

1. 캠퍼스 관리 솔루션을 엽니다.

   -   <https://make.powerapps.com>에 로그인합니다

   -   **환경**을 선택합니다.

   -   **솔루션**을 선택합니다.

   -   클릭하여 **캠퍼스 관리** 솔루션을 엽니다.

2. **새로 만들기**를 클릭하고 **흐름**을 선택합니다. 그러면 새 창에서 흐름 편집기가 열립니다.

3. *되풀이*를 검색하고 **예약** 커넥터 및 **되풀이** 트리거를 차례로 선택합니다.

4. **간격**을 **15분**으로 설정합니다.

5. **새 단계**를 클릭합니다. **현재**를 검색하고 **Common Data Service(현재 환경)** 커넥터를 선택합니다. **레코드 나열** 작업을 선택합니다.

   * **엔터티 이름**으로 **방문**을 입력합니다.
   
   * **고급 옵션 표시** 클릭

   * 다음 식을 **필터 쿼리**로 입력합니다.

     ```
     statecode eq 0 and bc_actualstart ne null and bc_actualend eq null and Microsoft.Dynamics.CRM.OlderThanXMinutes(PropertyName='bc_scheduledend',PropertyValue=15)
     ```

   이걸 분석해 보면

   * `statecode eq 0`는 활성 방문을 필터링합니다 (상태가 활성과 동등)
   * `bc_actualstart ne null`은 실제 시작에 값이 있는 방문으로 검색을 제한합니다 (예: 체크 인이 있었다)
   * `bc_actualend eq null`은 체크 아웃이 없었던 방문으로 검색을 제한합니다 (실제 끝은 값이 없음) 
   * `Microsoft.Dynamics.CRM.OlderThanXMinutes(PropertyName='bc_scheduledend', PropertyValue=15)`는 방문이 15분 이상 전에 완료되는 경우 방문을 제한합니다.  

6.  **새 단계**를 클릭합니다. **적용**을 검색하고 **각 작업에 적용**을 선택합니다 

7.  **이전 단계에서 출력 선택** 필드에서 동적 콘텐츠의 **값**을 선택합니다.

8.  관련 레코드에 대한 건물 데이터 검색

    * 루프 내부의  **작업 추가**를 클릭합니다.
    * **현재**를 검색하고 **Common Data Service(현재 환경)** 커넥터를 선택합니다. 
    * **레코드 가져오기** 작업을 선택합니다.
    * **레코드 가져오기** 옆의 ...를 클릭하고 **이름 바꾸기**를 선택합니다. **GetBuilding**을 단계 이름으로 입력합니다.
    * **건물을** **엔터티 이름**으로 선택합니다
    * 동적 콘텐츠에서 **항목 ID**로 **건물(값)** 선택

9.  관련 레코드에 대한 방문자 데이터 검색

    * 루프 내부의  **작업 추가**를 클릭합니다.
    * **현재**를 검색하고 **Common Data Service(현재 환경)** 커넥터를 선택합니다. 
    * **레코드 가져오기** 작업을 선택합니다.
    * **레코드 가져오기** 옆의 ...를 클릭하고 **이름 바꾸기**를 선택합니다. **GetVisitor**를 단계 이름으로 입력합니다.
    * **엔터티 이름**으로 **방문** 선택
    * 동적 콘텐츠에서 **방문자(값)**를 **항목 ID**로 선택
    
10.  관련 레코드에 대한 소유자 데이터 검색
    * 루프 내부의  **작업 추가**를 클릭합니다.
    * **현재**를 검색하고 **Common Data Service(현재 환경)** 커넥터를 선택합니다. 
    * **레코드 가져오기** 작업을 선택합니다.
    * **레코드 가져오기** 옆의 ...를 클릭하고 **이름 바꾸기**를 선택합니다. **GetUser**를 단계 이름으로 입력
    * **엔터티 이름**으로 **방문** 선택
    * 동적 콘텐츠에서 **소유자(값)**를 **항목 ID**로 선택

11.  **각 루프에 적용** 내에서 유지하면서 **메일** 연결에서 **전자 메일 알림 보내기** 작업 추가

12.  전자 메일 주소를  **받는 사람**으로 입력합니다.

13.  **제목** 필드에 "너무 오래 머무는 {**방문자(값)**} 연락"을 입력합니다. **방문자(값)**는 **GetVisitor** 단계의 동적 콘텐츠입니다.

14.  **본문** 필드에 "{**이름**}"을/를 빌드할 때 일어났습니다"를 입력합니다. **이름**은 **GetBuilding** 단계의 동적 콘텐츠입니다.

15.  **고급 옵션 표시**를 클릭합니다.

16.  **GetUser** 단계에서 **기본 전자 메일**을 찾아 CC 필드에 삽입합니다 (모임 주최자는 전자 메일의 복사본을 받게 됩니다).

17.  왼쪽 상단 모서리에서 **제목 없음** 흐름 이름을 선택하고 **보안 스윕**으로 이름을 바꿉니다.

16.  **저장**을 누릅니다

## 작업 #2: 흐름의 유효성 검사 및 테스트

1. 다음과 같은 방문 레코드를 찾거나 만듭니다.
   1. 방문 레코드를 찾거나 생성합니다
   2. 예약된 종료 시간이 과거입니다 (15분 이상)
   3. 실제 시작 값은 있습니다.
2. 솔루션으로 이동하고 **보안 스윕** 흐름을 찾습니다. ... 및 **편집**을 차례로 클릭합니다.
3. 흐름이 열리면 **테스트**를 클릭합니다.
4. **트리거 작업을 수행합니다**를 선택합니다.
5. **테스트** 및 **흐름 실행**을 클릭합니다.
6. 흐름이 완료되면 **완료**를 클릭합니다. 
7. **각각 적용**을 확장한 다음, **전자 메일 알림 보내기** 단계를 확장합니다. **제목**과 **전자 메일 본문** 값을 확인합니다. **더 보기**를 펼치고 **CC** 값을 확인합니다.
8. 솔루션으로 이동해서 흐름 옆의 ...를 클릭하고 **끄기**를 선택합니다. 이는 테스트 시스템의 일정에 따라 흐름이 실행되지 않도록 하기 위한 것입니다.

# 과제

* 알림 흐름에 건물 정보와 맵을 추가합니다.
* 방문 코드에 대한 바코드를 생성할 수 있습니까? 언제 유용할까요?
* 전자 메일 본문에서 사용자에게 친숙한 날짜 형식을 보장하는 방법은 뭔가요?
* 체류 연장 정보가 있는 테이블을 생성하고 단일 전자 메일만 보낼 수 있습니까?
